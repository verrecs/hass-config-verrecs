action: fire-dom-event
browser_mod:
  service: browser_mod.popup
  data:
    title: Consommation électrique
    size: fullscreen
    content:
      type: grid
      columns: 2
      square: false
      cards:

        - type: custom:apexcharts-card
          header:
            show: true
            title: Historique des 15 derniers jours
            show_states: true
            colorize_states: true
          graph_span: 7d
          update_interval: 1d
          stacked : true
          locale: fr
          color_list: [var(--primary-color), var(--secondary-color), var(--third-color), var(--fourth-color), var(--fifth-color)]
          show:
            last_updated: true
          apex_config:
            chart:
              fontFamily: var(--primary-font-family)
              height: 550px
            xaxis:
              labels:
                show: false
                # datetimeFormatter:
                #   day: 'dddd'
            tooltip:
              enable: true
              shared: true
              style:
                fontSize: 14px
              x:
                show: true
                format: 'dddd d MMMM'
              y:
                formatter: |
                  function(value, { series, seriesIndex, dataPointIndex, w }) {
                    return value
                  }
            legend:
              show : false 
          yaxis:
            - id: elec
              show: true
              max: 3000
              opposite: true
              apex_config:
                forceNiceScale: true
                decimalsInFloat: 0
                labels:
                  formatter: |
                    EVAL:v => `${v.toFixed(0)} kWh`
            - id : temp
              show: true
              apex_config:
                title:
                  text: Température extérieure
                forceNiceScale: true
                decimalsInFloat: 0
                labels:
                  style:
                    color: var(--primary-color)
                  formatter: |
                    EVAL:v => `${v.toFixed(0)} °C`
          all_series_config:
            type: column
            opacity: 0.2
          series:
            - entity: sensor.plug_bureau_energy
              name: PC Bureau
              stroke_width: 1
              yaxis_id: elec
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.plug_media_salon_energy
              name: Media salon
              stroke_width: 1
              yaxis_id: elec
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.plug_chambre_energy
              name: Prises chambre (lit)
              stroke_width: 1
              yaxis_id: elec
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_salon
              name: Chauffage du salon (convecteur)
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_salon_2
              name: Chauffage du salon (inertie)
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_bureau
              name: Chauffage du bureau
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_chambre
              name: Chauffage de la chambre
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max
            - entity: sensor.tz3000_2putqrmw_ts011f_summation_delivered
              name: Prise du bar
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max
            - entity: sensor.prise_chambre_2_summation_delivered_2
              name: Prise de la chambre (entrée)
              stroke_width: 1
              yaxis_id: elec
              group_by:
                duration: 1d
                func: max

            - entity: sensor.paris_10eme_arrondissement_temperature
              name: Température extérieure
              yaxis_id: temp
              type: line
              color: var(--primary-color)
              stroke_width: 2
              show:
                in_header: false
              opacity: 1
              group_by:
                duration: 1d
                func: avg

        - type: custom:apexcharts-card
          header:
            show: true
            title: Temps réel
            show_states: true
            colorize_states: true
          chart_type: donut
          color_list: [var(--primary-color), var(--secondary-color), var(--third-color), var(--fourth-color), var(--fifth-color)]
          show:
            last_updated: true
          apex_config:
            chart:
              height: 550px
              fontFamily: var(--primary-font-family)
            tooltip:
              style:
                fontSize: 14px
            legend:
              show : false
            stroke:
              show: true
              width: 1
            dataLabels:
              formatter: |
                EVAL:function(value) {
                  return value.toFixed(0) + " %";
                }
            plotOptions:
              pie:
                donut:
                  labels:
                    show: true
                    total:
                      show: true
                      label: Total
                      fontSize: '30px'
                      fontFamily: 'Helvetica, Arial, sans-serif'
                      fontWeight: 600
                      color: '#373d3f'
                      formatter: |
                        EVAL:function(w) {
                          return w.globals.seriesTotals.reduce((a, b) => {return (a + b)} , 0).toFixed(0) + " W"
                          }
          all_series_config:
            opacity: 0.1
          series:
            - entity: sensor.plug_bureau_power
              name: PC Bureau
            - entity: sensor.plug_media_salon_power
              name: Media salon
            - entity: sensor.plug_chambre_power
              name: Prises chambre (lit)
            - entity: sensor.wiser_lts_power_salon
              name: Chauffage du salon (convecteur)
            - entity: sensor.wiser_lts_power_salon_2
              name: Chauffage du salon (inertie)
            - entity: sensor.wiser_lts_power_bureau
              name: Chauffage du bureau
            - entity: sensor.wiser_lts_power_chambre
              name: Chauffage de la chambre
            - entity: sensor.tz3000_2putqrmw_ts011f_active_power
              name: Prise du bar
            - entity: sensor.prise_chambre_2_active_power_2
              name: Prise de la chambre (entrée)


