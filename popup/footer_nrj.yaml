action: fire-dom-event
browser_mod:
  service: browser_mod.popup
  data:
    title: Consommation électrique
    size: fullscreen
    content:
      type: grid
      columns: 2
      square: false
      cards:

        - type: custom:apexcharts-card
          header:
            show: true
            title: Historique des 15 derniers jours
            show_states: true
            colorize_states: true
          graph_span: 15d
          update_interval: 12h
          stacked : true
          locale: fr
          color_list: [var(--primary-color), var(--secondary-color), var(--third-color), var(--fourth-color), var(--fifth-color)]
          show:
            last_updated: true
          apex_config:
            chart:
              fontFamily: var(--primary-font-family)
              height: 550px
            tooltip:
              style:
                fontSize: 14px
              x:
                show: true
                format: dddd
            legend:
              show : false 
            stroke:
              show: true
              width: 1
          all_series_config:
            type: column
            opacity: 0.2
          series:
            - entity: sensor.plug_bureau_energy
              name: PC Bureau
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.plug_media_salon_energy
              name: Media salon
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.plug_chambre_energy
              name: Prises chambre
              transform: "return x / 1000;"
              unit: kWh
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_salon
              name: Chauffage du salon (convecteur)
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_salon_2
              name: Chauffage du salon (inertie)
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_bureau
              name: Chauffage du bureau
              group_by:
                duration: 1d
                func: max
            - entity: sensor.wiser_lts_energy_chambre
              name: Chauffage de la chambre
              group_by:
                duration: 1d
                func: max
            - entity: sensor.tz3000_2putqrmw_ts011f_summation_delivered
              name: Prise du bar
              group_by:
                duration: 1d
                func: max


        - type: custom:apexcharts-card
          header:
            show: true
            title: Temps réel
            show_states: true
            colorize_states: true
          chart_type: donut
          color_list: [var(--primary-color), var(--secondary-color), var(--third-color), var(--fourth-color), var(--fifth-color)]
          apex_config:
            chart:
              height: 550px
              fontFamily: var(--primary-font-family)
            tooltip:
              style:
                fontSize: 14px
            x:
              show: true
              format: dddd
            legend:
              show : false
            stroke:
              show: true
              width: 1
            dataLabels:
              formatter: |
                EVAL:function(value) {
                  return value.toFixed(0) + " %";
                }
            plotOptions:
              pie:
                donut:
                  labels:
                    show: true
                    total:
                      show: true
                      label: Total
                      fontSize: '40px'
                      fontFamily: 'Helvetica, Arial, sans-serif'
                      fontWeight: 600
                      color: '#373d3f'
                      formatter: |
                        EVAL:function(w) {
                          return w.globals.seriesTotals.reduce((a, b) => {return (a + b)} , 0).toFixed(0) + " W"
                          }
          all_series_config:
            opacity: 0.1
          series:
            - entity: sensor.plug_bureau_power
              name: PC Bureau
            - entity: sensor.plug_media_salon_power
              name: Media salon
            - entity: sensor.plug_chambre_power
              name: Prises chambre
            - entity: sensor.wiser_lts_power_salon
              name: Chauffage du salon (convecteur)
            - entity: sensor.wiser_lts_power_salon_2
              name: Chauffage du salon (inertie)
            - entity: sensor.wiser_lts_power_bureau
              name: Chauffage du bureau
            - entity: sensor.wiser_lts_power_chambre
              name: Chauffage de la chambre
            - entity: sensor.tz3000_2putqrmw_ts011f_active_power
              name: Prise du bar

