action: fire-dom-event
browser_mod:
  service: browser_mod.popup
  data:
    title: Philippo, l'aspiro déglingo
    # timeout: 180000
    style: |
      --popup-max-width: calc(385px + 800px);
# 
      # --primary-color: transparent; /* hide timeout progress */
    card_mod:
      style:
        # card divider border
        layout-card$grid-layout$: |
          #root {
            margin: -24px 0 !important;
          }
          hui-vertical-stack-card {
            border-right: 1.5px solid rgba(0, 0, 0, 0.2);
            border-radius: 0;
            transition: none;
          }
          /* phone */
          @media screen and (max-width: 1200px) {
            hui-vertical-stack-card {
              border-right: none;
              border-bottom: 1.5px solid rgba(0, 0, 0, 0.2);
            }
          }
    content:
      type: custom:layout-card
      layout_type: custom:grid-layout
      layout:
        margin: 0
        grid-template-columns: 385px 800px
        grid-template-rows: 1fr
        grid-template-areas: |
          "info map"
        mediaquery:
          #phone
          "(max-width: 1000px)":
            grid-template-columns: 1fr
            grid-template-rows: repeat(2, 1fr)
            grid-template-areas: |
              "info"
              "map"
      cards:

        - type: vertical-stack
          view_layout:
            grid-area: info
          cards:
          - type: entities
            title: Informations
            card_mod:
              class: header
              style: |
                .card-content {
                  padding: var(--tablet-popup-content-padding);
                  padding-bottom: 0;
                }
            entities:

            # - entity: vacuum.roborock_s7_pro_ultra
            # - entity: binary_sensor.roborock_s7_pro_ultra_cleaning
            # - entity: sensor.roborock_s7_pro_ultra_etat
            # - entity: sensor.roborock_s7_pro_ultra_duree_de_nettoyage
            # - entity: sensor.roborock_s7_pro_ultra_fin_du_dernier_nettoyage

            # - type: custom:bar-card
            #   width: 55%
            #   height: 2em
            #   decimal: 0
            #   unit_of_measurement: '%'
            #   positions:
            #     icon: outside
            #     indicator: 'off'
            #     name: outside
            #   severity:
            #     - color: '#303435'
            #       from: 11
            #       to: 999
            #     - color: var(--red-color)
            #       from: 0
            #       to: 10
            #   entity_row: true
            #   entities:
            #     - entity: sensor.roborock_s7_pro_ultra_batterie

            # - entity: sensor.roborock_s7_pro_ultra_temps_restant_filtre
            # - entity: sensor.roborock_s7_pro_ultra_temps_restant_brosse_principale
            # - entity: sensor.roborock_s7_pro_ultra_temps_restant_brosse_laterale
            # - entity: sensor.roborock_s7_pro_ultra_temps_restant_capteurs
            # - entity: binary_sensor.roborock_s7_pro_ultra_reservoir_d_eau_fixe
            # - entity: binary_sensor.roborock_s7_pro_ultra_serpilliere_fixee
            # - entity: sensor.roborock_s7_pro_ultra_erreur_de_dock
            # - entity: binary_sensor.roborock_s7_pro_ultra_penurie_d_eau

            - type: custom:more-info-card
              entity: vacuum.roborock_s7_pro_ultra
              card_mod:
                style:
                  # hide everything but ha-select
                  .: |
                    h1, state-card-content {
                      display: none;
                    }
                    .card-content {
                      padding: 1.5em 0 0 0.7em;
                    }
                  more-info-vacuum$:
                    .: |
                      div.flex-horizontal>div, div:nth-child(2), ha-attributes {
                        display: none;
                      }
                      ha-select {
                        display: contents;
                      }
                    ha-select:
                      $:
                        # no icon so remove label inset
                        .: |
                          .mdc-floating-label {
                            inset-inline-start: 0 !important;
                          }
                        # fix transparent menu background color
                        mwc-menu$: |
                          mwc-list {
                            background: var(--card-background-color);
                          }

            - entity: select.roborock_s7_pro_ultra_intensite_de_frottement
            - entity: select.roborock_s7_pro_ultra_parcours_de_lavage_de_sol
          # - type: custom:mod-card
          #   card_mod:
          #     style:
          #       # horizontal bottom buttons
          #       hui-horizontal-stack-card$: |
          #         #root {
          #           justify-content: space-evenly !important;
          #           padding: var(--tablet-popup-button-padding);
          #         }
          #   card:
          #     type: horizontal-stack
          #     cards:
          #       - type: custom:button-card
          #         entity: vacuum.roborock_s7_pro_ultra
          #         icon: mdi:play-pause
          #         name: "GO / Pause"
          #         tap_action:
          #           action: call-service
          #           service: >
          #             [[[
          #               return `[[[
          #                 return entity.state === 'docked' || entity.state === 'paused'
          #                   ? 'vacuum.start'
          #                   : 'vacuum.pause';
          #               ]]]`
          #             ]]]
          #           service_data:
          #             entity_id: vacuum.roborock_s7_pro_ultra
          #         template: icon_name

          #       - type: custom:button-card
          #         entity: vacuum.roborock_s7_pro_ultra
          #         icon: mdi:home-battery-outline
          #         name: "Retour station"
          #         tap_action:
          #           action: call-service
          #           service: vacuum.return_to_base
          #           service_data:
          #             entity_id: vacuum.roborock_s7_pro_ultra
          #         template: icon_name





          #   - entity: vacuum.roberto
          #   - entity: sensor.roberto_last_clean_end

          #   - type: custom:bar-card
          #     width: 55%
          #     height: 2em
          #     decimal: 0
          #     unit_of_measurement: '%'
          #     positions:
          #       icon: outside
          #       indicator: 'off'
          #       name: outside
          #     severity:
          #       - color: '#303435'
          #         from: 11
          #         to: 999
          #       - color: var(--red-color)
          #         from: 0
          #         to: 10
          #     entity_row: true
          #     entities:
          #       - entity: vacuum.roberto
          #         attribute: battery_level
          #         name: Batterie
          #         icon: mdi:battery
          #       - entity: sensor.template_vacuum_filter
          #       - entity: sensor.template_vacuum_mainbrush
          #       - entity: sensor.template_vacuum_sidebrush
          #       - entity: sensor.template_vacuum_sensors

          #   - type: custom:more-info-card
          #     entity: vacuum.roberto
          #     card_mod:
          #       style:
          #         # hide everything but ha-select
          #         .: |
          #           h1, state-card-content {
          #             display: none;
          #           }
          #           .card-content {
          #             padding: 1.5em 0 0 0.7em;
          #           }
          #         more-info-vacuum$:
          #           .: |
          #             div.flex-horizontal>div, div:nth-child(2), ha-attributes {
          #               display: none;
          #             }
          #             ha-select {
          #               display: contents;
          #             }
          #           ha-select:
          #             $:
          #               # no icon so remove label inset
          #               .: |
          #                 .mdc-floating-label {
          #                   inset-inline-start: 0 !important;
          #                 }
          #               # fix transparent menu background color
          #               mwc-menu$: |
          #                 mwc-list {
          #                   background: var(--card-background-color);
          #                 }

          # - type: custom:mod-card
          #   card_mod:
          #     style:
          #       # horizontal bottom buttons
          #       hui-horizontal-stack-card$: |
          #         #root {
          #           justify-content: space-evenly !important;
          #           padding: var(--tablet-popup-button-padding);
          #         }
          #   card:
          #     type: horizontal-stack
          #     cards:
          #       - type: custom:button-card
          #         entity: vacuum.roberto
          #         icon: mdi:play-pause
          #         name: "GO / Pause"
          #         tap_action:
          #           action: call-service
          #           service: >
          #             [[[
          #               return `[[[
          #                 return entity.state === 'docked' || entity.state === 'paused'
          #                   ? 'vacuum.start'
          #                   : 'vacuum.pause';
          #               ]]]`
          #             ]]]
          #           service_data:
          #             entity_id: vacuum.roberto
          #         template: icon_name

          #       - type: custom:button-card
          #         entity: vacuum.roberto
          #         icon: mdi:home-battery-outline
          #         name: "Retour station"
          #         tap_action:
          #           action: call-service
          #           service: vacuum.return_to_base
          #           service_data:
          #             entity_id: vacuum.roberto
          #         template: icon_name

                # - type: custom:button-card
                #   icon: mdi:delete-empty
                #   tap_action:
                #     action: call-service
                #     service: vacuum.send_command
                #     service_data:
                #       entity_id: vacuum.roberto
                #       command: app_goto_target
                #       params: [16821,23105]
                #   template: icon_only

        ### Carte
        - type: custom:xiaomi-vacuum-map-card
          map_source:
            camera: camera.roborock_s7_pro_ultra_map
            crop:
              top : 250
              left : 200
              right : 300
              bottom : 350
          calibration_source:
            camera: true
          entity: vacuum.roborock_s7_pro_ultra
          vacuum_platform: humbertogontijo/homeassistant-roborock
          map_locked: false
          two_finger_pan: true

          map_modes:
            - name: Zone cleanup
              icon: mdi:select-drag
              run_immediately: false
              coordinates_rounding: true
              coordinates_to_meters_divider: 1000
              selection_type: MANUAL_RECTANGLE
              max_selections: 5
              repeats_type: EXTERNAL
              max_repeats: 3
              service_call_schema:
                service: xiaomi_miio.vacuum_clean_zone
                service_data:
                  zone: '[[selection]]'
                  repeats: '[[repeats]]'
                  entity_id: '[[entity_id]]'
              predefined_selections: []
              variables: {}
            - name: Pin & Go
              icon: mdi:map-marker-plus
              run_immediately: false
              coordinates_rounding: true
              coordinates_to_meters_divider: 1000
              selection_type: MANUAL_POINT
              max_selections: 999
              repeats_type: NONE
              max_repeats: 1
              service_call_schema:
                service: xiaomi_miio.vacuum_goto
                service_data:
                  x_coord: '[[point_x]]'
                  y_coord: '[[point_y]]'
                  entity_id: '[[entity_id]]'
              predefined_selections: []
              variables: {}
            - template: vacuum_clean_segment
              predefined_selections:
                - id: '16'
                  icon:
                    name: mdi:broom
                    x: 24950
                    'y': 19700
                  label:
                    text: Room 16
                    x: 24950
                    'y': 19700
                    offset_y: 35
                  outline:
                    - - 23700
                      - 17550
                    - - 26200
                      - 17550
                    - - 26200
                      - 21850
                    - - 23700
                      - 21850
                - id: '17'
                  icon:
                    name: mdi:broom
                    x: 21825
                    'y': 19875
                  label:
                    text: Room 17
                    x: 21825
                    'y': 19875
                    offset_y: 35
                  outline:
                    - - 19900
                      - 18000
                    - - 23750
                      - 18000
                    - - 23750
                      - 21750
                    - - 19900
                      - 21750
                - id: '18'
                  icon:
                    name: mdi:broom
                    x: 22350
                    'y': 16700
                  label:
                    text: Room 18
                    x: 22350
                    'y': 16700
                    offset_y: 35
                  outline:
                    - - 20150
                      - 15000
                    - - 24550
                      - 15000
                    - - 24550
                      - 18400
                    - - 20150
                      - 18400
                - id: '19'
                  icon:
                    name: mdi:broom
                    x: 25800
                    'y': 20050
                  label:
                    text: Room 19
                    x: 25800
                    'y': 20050
                    offset_y: 35
                  outline:
                    - - 24950
                      - 19400
                    - - 26650
                      - 19400
                    - - 26650
                      - 20700
                    - - 24950
                      - 20700
                - id: '20'
                  icon:
                    name: mdi:broom
                    x: 25225
                    'y': 23000
                  label:
                    text: Room 20
                    x: 25225
                    'y': 23000
                    offset_y: 35
                  outline:
                    - - 23800
                      - 21800
                    - - 26650
                      - 21800
                    - - 26650
                      - 24200
                    - - 23800
                      - 24200
                - id: '23'
                  icon:
                    name: mdi:broom
                    x: 22175
                    'y': 22975
                  label:
                    text: Room 23
                    x: 22175
                    'y': 22975
                    offset_y: 35
                  outline:
                    - - 20450
                      - 21850
                    - - 23900
                      - 21850
                    - - 23900
                      - 24100
                    - - 20450
                      - 24100
                - id: '24'
                  icon:
                    name: mdi:broom
                    x: 24075
                    'y': 26850
                  label:
                    text: Room 24
                    x: 24075
                    'y': 26850
                    offset_y: 35
                  outline:
                    - - 18500
                      - 24250
                    - - 29650
                      - 24250
                    - - 29650
                      - 29450
                    - - 18500
                      - 29450
          additional_presets: []




        # - type: custom:xiaomi-vacuum-map-card
        #   title: Carte
        #   view_layout:
        #     grid-area: map
        #   card_mod:
        #     class: header
        #     style: |
        #       ha-card {
        #         --map-card-primary-color: #FFFFFF10;
        #         --map-card-secondary-color: rgb(0,0,0);
        #         --map-card-secondary-text-color: #FFFFFF;
        #         --map-card-zoomer-background: none;
        #         --map-card-predefined-rectangle-fill-color: none;
        #         --map-card-predefined-rectangle-line-color: none;
        #         --map-card-predefined-rectangle-line-color-selected: rgba(255, 255, 255, 0.5);
        #         --map-card-predefined-rectangle-fill-color-selected: rgba(42, 124, 194, 0.1);
        #         --map-card-predefined-rectangle-icon-background-color-selected: rgb(42, 124, 194);
        #         --map-card-internal-big-radius: 0.6em !important;
        #       }
        #       div.map-wrapper, div.controls-wrapper {
        #         padding: var(--tablet-popup-content-padding);
        #         padding-top: 0;
        #         padding-bottom: 0;
        #         letter-spacing: normal;
        #       }
        #       div.tiles-wrapper, div.vacuum-controls, #map-zoomer-overlay {
        #         display: none;
        #       }
        #       div.map-controls-wrapper {
        #         padding-top: 24px;
        #       }
        #       paper-button {
        #         --mdc-icon-size: 2em;
        #         color: #9da0a2 !important;
        #         padding: 0.42em;
        #       }

        #   language: fr
        #   entity: vacuum.roborock_s7_pro_ultra
        #   map_source:
        #     camera: camera.roborock_s7_pro_ultra_map
        #   calibration_source:
        #     camera: true
        #   map_locked: true
        #   two_finger_pan: true
        #   map_modes:
        #     - template: vacuum_clean_segment
        #       predefined_selections:
        #         - id: '16'
        #           icon:
        #             name: mdi:door-sliding-open
        #             x: 24588
        #             'y': 19634
        #           label:
        #             text: Couloir
        #             x: 24556
        #             'y': 19634
        #             offset_y: 35
        #           outline:
        #             - - 23700
        #               - 17550
        #             - - 26200
        #               - 17550
        #             - - 26200
        #               - 21800
        #             - - 23700
        #               - 21800
        #         - id: '17'
        #           icon:
        #             name: mdi:desktop-classic
        #             x: 22050
        #             'y': 20200
        #           label:
        #             text: Bureau
        #             x: 22050
        #             'y': 20200
        #             offset_y: 35
        #           outline:
        #             - - 20350
        #               - 18650
        #             - - 23750
        #               - 18650
        #             - - 23750
        #               - 21750
        #             - - 20350
        #               - 21750
        #         - id: '18'
        #           icon:
        #             name: mdi:bed-king
        #             x: 22375
        #             'y': 16900
        #           label:
        #             text: Chambre
        #             x: 22375
        #             'y': 16900
        #             offset_y: 35
        #           outline:
        #             - - 20200
        #               - 15400
        #             - - 24550
        #               - 15400
        #             - - 24550
        #               - 18400
        #             - - 20200
        #               - 18400
        #         - id: '19'
        #           icon:
        #             name: mdi:bathtub
        #             x: 25800
        #             'y': 20050
        #           label:
        #             text: Salle de bain
        #             x: 25800
        #             'y': 20050
        #             offset_y: 35
        #           outline:
        #             - - 24950
        #               - 19400
        #             - - 26650
        #               - 19400
        #             - - 26650
        #               - 20700
        #             - - 24950
        #               - 20700
        #         - id: '20'
        #           icon:
        #             name: mdi:coat-rack
        #             x: 25225
        #             'y': 22975
        #           label:
        #             text: Entrée
        #             x: 25225
        #             'y': 22975
        #             offset_y: 35
        #           outline:
        #             - - 23800
        #               - 21750
        #             - - 26650
        #               - 21750
        #             - - 26650
        #               - 24200
        #             - - 23800
        #               - 24200
        #         - id: '23'
        #           icon:
        #             name: mdi:fridge
        #             x: 22200
        #             'y': 23000
        #           label:
        #             text: Cuisine
        #             x: 22200
        #             'y': 23000
        #             offset_y: 35
        #           outline:
        #             - - 20500
        #               - 21850
        #             - - 23900
        #               - 21850
        #             - - 23900
        #               - 24150
        #             - - 20500
        #               - 24150
        #         - id: '24'
        #           icon:
        #             name: mdi:sofa
        #             x: 22975
        #             'y': 26775
        #           label:
        #             text: Salon
        #             x: 22975
        #             'y': 26775
        #             offset_y: 35
        #           outline:
        #             - - 19650
        #               - 24250
        #             - - 26300
        #               - 24250
        #             - - 26300
        #               - 29300
        #             - - 19650
        #               - 29300
        #     - template: vacuum_clean_zone
        #     - template: vacuum_goto